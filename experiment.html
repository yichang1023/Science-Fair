<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç§‘å±•å¯¦é©—æ§åˆ¶å°</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; background: #f9f9f9; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        textarea { width: 100%; height: 100px; }
        button { padding: 10px 20px; background: #0066cc; color: white; border: none; cursor: pointer; font-size: 16px; }
        #resultArea { white-space: pre-wrap; background: #fff; padding: 10px; border: 1px solid #ddd; }
        .stat { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç§‘å±•æ•¸æ“šæ”¶é›†æ§åˆ¶å°</h1>
    
    <div class="box">
        <label>1. é¸æ“‡æ¨¡å‹ (ç‚ºäº† RQ1)</label>
        <select id="modelSelect">
            <option value="gemini-1.5-flash">Gemini 1.5 Flash (å¿«é€Ÿç‰ˆ)</option>
            <option value="gemini-1.5-pro">Gemini 1.5 Pro (è°æ˜ç‰ˆ)</option>
        </select>
    </div>

    <div class="box">
        <label>2. é¸æ“‡ç­–ç•¥ (ç‚ºäº† RQ2)</label>
        <select id="strategySelect" onchange="updatePromptTemplate()">
            <option value="baseline">Baseline (ç›´æ¥å•)</option>
            <option value="persona">Persona (åŠ ä¸Šè§’è‰²è¨­å®š)</option>
            <option value="context">Context (åŠ ä¸ŠçŸ¥è­˜åº«/RAG)</option>
        </select>
    </div>

    <div class="box">
        <label>3. è¼¸å…¥æ¸¬è©¦é¡Œç›® (User Input)</label>
        <input type="text" id="userInput" placeholder="ä¾‹å¦‚ï¼šè«‹ä»‹ç´¹æ•…å®®åšç‰©é™¢..." style="width: 100%; padding: 8px;">
    </div>

    <div class="box">
        <label>4. å¯¦éš›ç™¼é€çš„ Prompt (è‡ªå‹•ç”Ÿæˆï¼Œè«‹å‹¿ä¿®æ”¹)</label>
        <textarea id="finalPrompt" readonly></textarea>
        <br><br>
        <button onclick="runExperiment()">ğŸš€ åŸ·è¡Œå¯¦é©—ä¸¦ç´€éŒ„</button>
    </div>

    <div class="box">
        <h3>ğŸ“Š å¯¦é©—çµæœ (è«‹è¤‡è£½åˆ° Excel)</h3>
        <p>è€—æ™‚ (RQ3): <span id="timeDisplay" class="stat">0</span> ms</p>
        <p>AI å›æ‡‰:</p>
        <div id="resultArea">...ç­‰å¾…åŸ·è¡Œ...</div>
    </div>

    <script>
        // ç‚ºäº† RQ2 è¨­è¨ˆçš„ç­–ç•¥æ¨£æ¿
        function updatePromptTemplate() {
            const strategy = document.getElementById('strategySelect').value;
            const input = document.getElementById('userInput').value;
            let final = input;

            if (strategy === 'persona') {
                final = "ä½ æ˜¯ä¸€ä½è³‡æ·±çš„å°ç£è¯èªæ•™å¸«ï¼Œè«‹ç”¨å°ç£åœ¨åœ°çš„èªæ°£èˆ‡ç”¨è©å›ç­”ä»¥ä¸‹å•é¡Œï¼š\n" + input;
            } else if (strategy === 'context') {
                // é€™è£¡æ¨¡æ“¬ã€ŒçŸ¥è­˜æ³¨å…¥ã€
                final = "åƒè€ƒè³‡è¨Šï¼šã€åœ‹ç«‹æ•…å®®åšç‰©é™¢ä½æ–¼å°åŒ—å¸‚å£«æ—å€ï¼Œæ”¶è—è¿‘70è¬ä»¶æ–‡ç‰©...ã€\nè«‹æ ¹æ“šä¸Šè¿°è³‡è¨Šå›ç­”ï¼š\n" + input;
            }
            
            document.getElementById('finalPrompt').value = final;
        }

        // ç›£è½è¼¸å…¥æ¡†ï¼Œå³æ™‚æ›´æ–° Prompt
        document.getElementById('userInput').addEventListener('input', updatePromptTemplate);

        async function runExperiment() {
            const prompt = document.getElementById('finalPrompt').value;
            const model = document.getElementById('modelSelect').value;
            const resultArea = document.getElementById('resultArea');
            const timeDisplay = document.getElementById('timeDisplay');

            resultArea.innerText = "ç”Ÿæˆä¸­...";
            
            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt, model })
                });
                const data = await res.json();
                
                resultArea.innerText = data.output;
                timeDisplay.innerText = data.latency; // é¡¯ç¤ºå¾Œç«¯å›å‚³çš„æ™‚é–“
            } catch (e) {
                resultArea.innerText = "éŒ¯èª¤ï¼š" + e;
            }
        }
    </script>
</body>
</html>
