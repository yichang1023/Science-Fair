<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ğŸ§ª 2026 LLM å¹»è¦ºé‡åŒ–è©•æ¸¬å¯¦é©—å®¤ (Journal Grade)</title>
    <style>
        body { font-family: "Segoe UI", "Microsoft JhengHei", sans-serif; padding: 20px; background: #f0f2f5; max-width: 1400px; margin: 0 auto; color: #1e293b; }
        header { text-align: center; margin-bottom: 25px; }
        h1 { margin: 0; font-weight: 800; color: #0f172a; }
        .subtitle { color: #64748b; font-size: 0.9em; margin-top: 5px; }
        
        /* ä½ˆå±€ */
        .grid { display: grid; grid-template-columns: 380px 1fr; gap: 25px; }
        
        /* å¡ç‰‡é¢¨æ ¼ */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .card h3 { margin-top: 0; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; color: #334155; }
        
        /* æ§åˆ¶å…ƒä»¶ */
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #475569; font-size: 0.9em; }
        select, textarea, input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        select { background-color: #f8fafc; }
        textarea { height: 250px; font-family: monospace; resize: vertical; }

        /* æŒ‰éˆ•ç¾¤ */
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-start { background: #2563eb; color: white; } .btn-start:hover { background: #1d4ed8; }
        .btn-stop { background: #ef4444; color: white; } .btn-stop:hover { background: #dc2626; }
        .btn-csv { background: #10b981; color: white; } .btn-csv:hover { background: #059669; }
        button:disabled { background: #e2e8f0; color: #94a3b8; cursor: not-allowed; }

        /* é€²åº¦æ¢ */
        .progress-container { height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; margin: 10px 0; }
        .progress-bar { height: 100%; background: #2563eb; width: 0%; transition: width 0.3s; }
        
        /* æ•¸æ“šè¡¨æ ¼ */
        .table-wrap { height: 700px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: #f8fafc; padding: 12px; text-align: left; position: sticky; top: 0; border-bottom: 2px solid #e2e8f0; color: #475569; }
        td { padding: 10px; border-bottom: 1px solid #f1f5f9; vertical-align: top; }
        
        /* æ¨™ç±¤ */
        .tag { padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: bold; }
        .tag-gray { background: #f1f5f9; color: #64748b; }
        .tag-green { background: #dcfce7; color: #166534; }
        .tag-blue { background: #dbeafe; color: #1e40af; }
        .tag-red { background: #fee2e2; color: #991b1b; }

    </style>
</head>
<body>

<header>
    <h1>ğŸ§ª 2026 LLM å¹»è¦ºé‡åŒ–è©•æ¸¬å¯¦é©—å®¤</h1>
    <div class="subtitle">é‡å° GPT-4/5 ä¸–ä»£å·®ç•°èˆ‡åƒæ•¸é‡ç´šä¹‹å¯¦è­‰ç ”ç©¶ (Empirical Study on GPT Generations & Scale)</div>
</header>

<div class="grid">
    <div class="card">
        <h3>ğŸ›ï¸ è®Šå› æ§åˆ¶ (Variables)</h3>
        
        <label>1. æ¨¡å‹è®Šå›  (Independent Variable: Model)</label>
        <select id="modelSelect">
            <optgroup label="RQ1: ä¸–ä»£æ¼”åŒ– (GPT-4 vs GPT-5)">
                <option value="gpt-4o">GPT-4o (2024 Flagship)</option>
                <option value="gpt-5.2">GPT-5.2 (2026 Flagship)</option>
            </optgroup>
            <optgroup label="RQ2: åƒæ•¸é‡ç´š (Size/Compression)">
                <option value="gpt-4o-mini">GPT-4o Mini (Small)</option>
                <option value="gpt-5-nano">GPT-5 Nano (Tiny/Edge)</option>
            </optgroup>
            <optgroup label="RQ3: æ¨ç†æ€è€ƒ (Reasoning)">
                <option value="o1">o1 (Slow Thinking)</option>
                <option value="o3">o3 (Advanced Reasoning)</option>
            </optgroup>
            <optgroup label="å‚™ç”¨å°ç…§ (Reference)">
                <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                <option value="llama-3.1-70b-versatile">Llama 3.1 70B</option>
            </optgroup>
        </select>

        <label>2. æç¤ºç­–ç•¥ (Independent Variable: Prompt)</label>
        <select id="strategySelect">
            <option value="baseline">åŸºæº–æ¨¡å¼ (Zero-shot Baseline)</option>
            <option value="persona">è§’è‰²æ‰®æ¼” (Role-play: å°ç£å°ˆå®¶)</option>
            <option value="cot">æ€ç¶­éˆ (Chain-of-Thought)</option>
        </select>

        <label>3. æ¸¬è©¦é¡Œåº« (Input Data)</label>
        <textarea id="questionList" placeholder="è«‹è²¼ä¸Šæ¸¬è©¦é¡Œç›® (ä¸€è¡Œä¸€é¡Œ)..."></textarea>
        
        <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
        <div style="text-align: right; font-size: 12px; color:#64748b;" id="progressText">Ready</div>

        <div class="btn-group">
            <button class="btn-start" onclick="startExp()" id="btnStart">â–¶ åŸ·è¡Œå¯¦é©—</button>
            <button class="btn-stop" onclick="stopExp()" id="btnStop" disabled>â¹ åœæ­¢</button>
            <button class="btn-csv" onclick="downloadCSV()" id="btnCsv" disabled>ğŸ“¥ ä¸‹è¼‰æ•¸æ“š</button>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ“Š å¯¦æ™‚æ•¸æ“š (Real-time Metrics)</h3>
        <div class="table-wrap">
            <table id="resTable">
                <thead>
                    <tr>
                        <th width="5%">ID</th>
                        <th width="30%">é¡Œç›® (Prompt)</th>
                        <th width="40%">å›æ‡‰ (Response)</th>
                        <th width="10%">å­—æ•¸ (Len)</th>
                        <th width="10%">å»¶é² (ms)</th>
                        <th width="5%">ç‹€æ…‹</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="6" style="text-align:center; padding:20px; color:#94a3b8;">ç­‰å¾…å¯¦é©—å•Ÿå‹•...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let isRunning = false;
    let dataLog = [];
    
    async function startExp() {
        const qRaw = document.getElementById('questionList').value.trim();
        if(!qRaw) { alert("è«‹è¼¸å…¥é¡Œç›®ï¼"); return; }
        
        const questions = qRaw.split('\n').filter(x=>x.trim());
        const model = document.getElementById('modelSelect').value;
        const strategy = document.getElementById('strategySelect').value;
        
        isRunning = true;
        dataLog = [];
        toggleUI(true);
        document.querySelector('#resTable tbody').innerHTML = '';

        for(let i=0; i<questions.length; i++) {
            if(!isRunning) break;
            
            const q = questions[i];
            updateProgress(i+1, questions.length);
            
            // å»ºç«‹ Prompt
            let finalPrompt = q;
            if(strategy === 'persona') finalPrompt = `ä½ æ˜¯ä¸€ä½ç²¾é€šå°ç£æ­·å²èˆ‡æ–‡åŒ–çš„å°ˆå®¶ï¼Œè«‹å›ç­”ï¼š${q}`;
            if(strategy === 'cot') finalPrompt = `å•é¡Œï¼š${q}\nè«‹ä¸€æ­¥æ­¥æ€è€ƒå¾Œå›ç­” (Chain of Thought):`;

            // UI æ–°å¢ä¸€è¡Œ
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${i+1}</td><td>${q}</td><td style="color:#aaa;">ç”Ÿæˆä¸­...</td><td>-</td><td>-</td><td><span class="tag tag-gray">...</span></td>`;
            document.querySelector('#resTable tbody').appendChild(tr);
            scrollToBottom();

            // å‘¼å« API
            const startTime = Date.now();
            let rowData = { id: i+1, model, strategy, prompt: q, response: "", len: 0, latency: 0, status: "Fail" };

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt: finalPrompt, model: model })
                });
                const json = await res.json();
                
                if(json.error) throw new Error(json.error);

                rowData.response = json.output;
                rowData.latency = json.latency;
                rowData.len = json.output.length; // é‡åŒ–æ•¸æ“šï¼šå­—æ•¸
                rowData.status = "Success";

                // æ›´æ–° UI
                tr.innerHTML = `
                    <td>${i+1}</td>
                    <td>${q}</td>
                    <td><div style="max-height:80px; overflow:hidden; text-overflow:ellipsis;">${json.output}</div></td>
                    <td>${rowData.len}</td>
                    <td>${rowData.latency}</td>
                    <td><span class="tag tag-green">OK</span></td>
                `;

            } catch(e) {
                rowData.response = `Error: ${e.message}`;
                tr.innerHTML = `<td>${i+1}</td><td>${q}</td><td style="color:red;">${e.message}</td><td>-</td><td>-</td><td><span class="tag tag-red">ERR</span></td>`;
            }
            
            dataLog.push(rowData);
            if(i < questions.length-1) await new Promise(r => setTimeout(r, 1500)); // é¿å… API Rate Limit
        }
        
        isRunning = false;
        toggleUI(false);
        if(confirm("å¯¦é©—å®Œæˆï¼æ˜¯å¦ç«‹å³ä¸‹è¼‰ CSV é€²è¡Œåˆ†æï¼Ÿ")) downloadCSV();
    }

    function stopExp() { isRunning = false; }

    function downloadCSV() {
        // è£½ä½œç¬¦åˆæœŸåˆŠåˆ†æéœ€æ±‚çš„ CSV (åŒ…å«äººå·¥æ¨™è¨˜æ¬„ä½)
        let csv = "\uFEFFID,Model,Strategy,Prompt,Response,Length_Chars,Latency_ms,Error_Type_Label(Manual)\n";
        dataLog.forEach(row => {
            const safeRes = row.response.replace(/"/g, '""').replace(/\n/g, ' ');
            const safePrompt = row.prompt.replace(/"/g, '""');
            csv += `${row.id},${row.model},${row.strategy},"${safePrompt}","${safeRes}",${row.len},${row.latency},\n`;
        });
        
        const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Experiment_${document.getElementById('modelSelect').value}_${Date.now()}.csv`;
        link.click();
    }

    function toggleUI(disabled) {
        document.getElementById('btnStart').disabled = disabled;
        document.getElementById('btnCsv').disabled = disabled;
        document.getElementById('btnStop').disabled = !disabled;
    }
    
    function updateProgress(curr, total) {
        const pct = (curr/total)*100;
        document.getElementById('progressBar').style.width = pct + "%";
        document.getElementById('progressText').innerText = `${curr} / ${total}`;
    }
    
    function scrollToBottom() {
        const div = document.querySelector('.table-wrap');
        div.scrollTop = div.scrollHeight;
    }
</script>

</body>
</html>
