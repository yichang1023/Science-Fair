<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>âš¡ï¸ 2026 AI å¯¦é©—å®¤ (Safety Mode)</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; background: #f4f6f9; max-width: 1200px; margin: 0 auto; }
        h1 { color: #2c3e50; text-align: center; }
        .panel { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        select, textarea, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; }
        button { background: #27ae60; color: white; font-weight: bold; cursor: pointer; border: none; padding: 15px; }
        button:hover { background: #219150; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #eee; }
        .status-err { color: red; background: #fee; }
        .status-ok { color: green; background: #eef; }
    </style>
</head>
<body>

    <h1>âš¡ï¸ 2026 AI å¯¦é©—å®¤ (å®‰å…¨æ¨¡å¼)</h1>
    <p style="text-align:center; color:#666;">å·²ç§»é™¤ä¸æ”¯æ´çš„èˆŠç‰ˆæ¨¡å‹ï¼Œåƒ…ä¿ç•™ç©©å®šç‰ˆæœ¬</p>

    <div style="display:grid; grid-template-columns: 300px 1fr; gap:20px;">
        <div class="panel">
            <h3>âš™ï¸ è¨­å®š</h3>
            <label>é¸æ“‡æ¨¡å‹</label>
            <select id="modelSelect">
                <optgroup label="Google (æ¨è–¦)">
                    <option value="gemini-1.5-flash">Gemini 3 Flash (Fast & Stable)</option>
                    <option value="gemini-1.5-pro">Gemini 3 Pro (High Quality)</option>
                </optgroup>
                <optgroup label="OpenAI">
                    <option value="gpt-4o-mini">GPT-5.2 Instant</option>
                    <option value="gpt-4o">GPT-5.2 Thinking</option>
                </optgroup>
                <optgroup label="Groq">
                    <option value="llama-3.1-8b-instant">Grok 4.1 Flash</option>
                    <option value="llama-3.1-70b-versatile">Grok 4.1 Thinking</option>
                </optgroup>
            </select>

            <br><br>
            <label>ç”Ÿæˆç­–ç•¥</label>
            <select id="strategySelect">
                <option value="baseline">åŸºæº–æ¨¡å¼ (Baseline)</option>
                <option value="persona">è§’è‰²æ‰®æ¼” (Persona)</option>
            </select>

            <br><br>
            <label>é¡Œåº« (ä¸€è¡Œä¸€é¡Œ)</label>
            <textarea id="questionList" placeholder="è«‹è¼¸å…¥é¡Œç›®...">å°ç£æœ€é«˜çš„å±±æ˜¯å“ªä¸€åº§ï¼Ÿ</textarea>

            <br><br>
            <button onclick="startBatch()" id="startBtn">â–¶ é–‹å§‹æ¸¬è©¦</button>
            <button onclick="downloadCSV()" style="background:#3498db; margin-top:10px;">ğŸ“¥ ä¸‹è¼‰ CSV</button>
            <div id="progressBox" style="margin-top:10px; color:#666;"></div>
        </div>

        <div class="panel">
            <h3>ğŸ“Š çµæœç›£æ§</h3>
            <div style="max-height:600px; overflow-y:auto;">
                <table id="resultTable">
                    <thead>
                        <tr><th>ID</th><th>é¡Œç›®</th><th>å›æ‡‰</th><th>ç‹€æ…‹</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const sleep = (ms) => new Promise(r => setTimeout(r, ms));
        let results = [];

        async function startBatch() {
            const questions = document.getElementById('questionList').value.split('\n').filter(q => q.trim());
            const model = document.getElementById('modelSelect').value;
            const strategy = document.getElementById('strategySelect').value;
            
            if(!questions.length) { alert("è«‹è¼¸å…¥é¡Œç›®"); return; }
            
            document.querySelector('#resultTable tbody').innerHTML = '';
            results = [];

            for (let i = 0; i < questions.length; i++) {
                const q = questions[i];
                document.getElementById('progressBox').innerText = `æ­£åœ¨æ¸¬è©¦: ${i+1} / ${questions.length}`;
                
                let prompt = q;
                if(strategy === 'persona') prompt = `ä½ æ˜¯ä¸€ä½å°ç£è€å¸«ï¼Œè«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼š${q}`;

                // æ›´æ–°è¡¨æ ¼é¡¯ç¤º Loading
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${i+1}</td><td>${q}</td><td>...</td><td>Running</td>`;
                document.querySelector('#resultTable tbody').appendChild(tr);

                let output = "", status = "Success", latency = 0;
                
                try {
                    const res = await fetch('/api/generate', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ prompt: prompt, model: model })
                    });
                    const data = await res.json();
                    
                    if (data.error) throw new Error(data.error);
                    output = data.output;
                    latency = data.latency;

                } catch (e) {
                    output = "Error: " + e.message;
                    status = "Failed";
                }

                // æ›´æ–°çµæœ
                results.push({id: i+1, q, output, model, status, latency});
                tr.innerHTML = `<td>${i+1}</td><td>${q}</td><td>${output}</td><td class="${status === 'Success'?'status-ok':'status-err'}">${status}</td>`;
                
                await sleep(2000);
            }
            alert("å®Œæˆï¼");
        }

        function downloadCSV() {
            let csv = "\uFEFFID,Model,Question,Output,Status\n";
            results.forEach(r => {
                csv += `${r.id},${r.model},"${r.q}","${r.output.replace(/"/g, '""')}",${r.status}\n`;
            });
            const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `data_${new Date().getTime()}.csv`;
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>
